package sigstore

import (
	"testing"
)

func TestVerifyPayload(t *testing.T) {

	testMsg := []byte(`apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-cm
data:
  key1: val1
  key2: val2	
`)
	testEncodedSig := []byte(`MEYCIQCsvveUpURqfvRRTrceW/+gl8Hp6CRn/XspMGbD+szuXAIhAMJslDsB2kWLshFqfQk/gqGorImBvZLw/YJvCLNN1UUa`)
	testSig := []byte(base64decode(testEncodedSig))

	testEncodedCert := []byte(`LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5VENDQWsrZ0F3SUJBZ0lVQVBqbnUrWTBJRFpLQVh4RXlvbExnaDgvK1V3d0NnWUlLb1pJemowRUF3TXcKS2pFVk1CTUdBMVVFQ2hNTWMybG5jM1J2Y21VdVpHVjJNUkV3RHdZRFZRUURFd2h6YVdkemRHOXlaVEFlRncweQpNVEEwTVRNd01UTTNNakphRncweU1UQTBNVE13TVRVM01qSmFNRXd4SkRBaUJnTlZCQW9NRzJocGNtOXJkVzVwCkxtdHBkR0ZvWVhKaFFHZHRZV2xzTG1OdmJURWtNQ0lHQTFVRUF3d2JhR2x5YjJ0MWJta3VhMmwwWVdoaGNtRkEKWjIxaGFXd3VZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFTGVaSU5RUEFXTGdvdkkrUwpWTUtiMk9XUncxdk9sbGhabVptQmRvV3hGNE9JOGhpSGRtMm9yK0dQakdwcS9GejhIRERoQjRveUxpM1dpRjIzCll0NjljcU9DQVM4d2dnRXJNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0QKQXpBTUJnTlZIUk1CQWY4RUFqQUFNQjBHQTFVZERnUVdCQlQ0eXRsTHplMExCTnZjc2NTQ0s5MktlMXJ3NERBZgpCZ05WSFNNRUdEQVdnQlRJeFIwQVFab2tLVEpSSk9zTnJrcnRTZ2JUN0RDQmpRWUlLd1lCQlFVSEFRRUVnWUF3CmZqQjhCZ2dyQmdFRkJRY3dBb1p3YUhSMGNEb3ZMM0J5YVhaaGRHVmpZUzFqYjI1MFpXNTBMVFl3TTJabE4yVTMKTFRBd01EQXRNakl5TnkxaVpqYzFMV1kwWmpWbE9EQmtNamsxTkM1emRHOXlZV2RsTG1kdmIyZHNaV0Z3YVhNdQpZMjl0TDJOaE16WmhNV1U1TmpJME1tSTVabU5pTVRRMkwyTmhMbU55ZERBbUJnTlZIUkVFSHpBZGdSdG9hWEp2CmEzVnVhUzVyYVhSaGFHRnlZVUJuYldGcGJDNWpiMjB3Q2dZSUtvWkl6ajBFQXdNRGFBQXdaUUl3UmpSR1NMY1cKVGFLU1VZTUgzaU1PeE1tMjhndHlZaWNBSENLZUJhQXBYWUdLMWJld3NMdHBCTGNKSFBFQ0Z4QWtBakVBaWMzQgpraTlJaWdDNVdTRzVLL2EzODRPeFMwOXZOV3VTSDBiSUpzeGhIblNucnlRMGV1RjNJdm8wYjBVWUwrbGoKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=`)
	testCert := []byte(base64decode(testEncodedCert))

	ok, err := verify(testMsg, testSig, testCert, nil, "", nil)
	if err != nil {
		t.Errorf("failed to verify tlog; %s", err.Error())
	} else {
		t.Log("succeeded to verify tlog!", ok)
	}

}
